{% extends "./template.html" %}

{% block content %}


<div class="container mt-4" style="max-width: 90%">
  <h2>Mise {{ task.num }}/{{ tasks_cnt }}: {{ task.title }}</h2>
  <div class="row">
    <!-- Left column with the task, conditions and reply form -->
    <div class="col-sm">

      <!-- Task description -->
      <div class="alert alert-info">
        {{ task.text|safe }}
      </div>

      <!-- Condition cards -->
      <div class="row row-cols-2 gx-3 gy-3">
        {% for cond, satisfied in conditions.items %}
        <div class="col">
          {% if satisfied is None %}
          <div class="card h-100">
            <div class="card-header">Podmínka {{ forloop.counter }}</div>
            <div class="card-body">
              <p class="card-text">{{ cond.text }}</p>
            </div>
          </div>
          {% elif satisfied %}
          <div class="card h-100 border-success">
            <div class="card-header bg-cond-header-success">
              <img src="https://neal.fun/password-game/checkmark.svg" style="height: 19px; width: 19px;">
              <span>Podmínka {{ forloop.counter }}</span>
            </div>
            <div class="card-body bg-cond-success">
              <p class="card-text">{{ cond.text }}</p>
            </div>
          </div>
          {% else %}
          <div class="card h-100 border-danger">
            <div class="card-header bg-cond-header-fail">
              <img src="https://neal.fun/password-game/error.svg" style="height: 19px; width: 19px;">
              <span>Podmínka {{ forloop.counter }}</span>
            </div>
            <div class="card-body bg-cond-fail">
              <p class="card-text">{{ cond.text }}</p>
            </div>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>

      <!-- Submit Form -->
      <div class="container">
        <form autocomplete="off" action="{% url 'game23:answer' player.id %}" method="post">
          {% csrf_token %}
          <div class="row mt-4">
            <div class="col-sm-3"></div>
            <label class="col-sm-1 col-form-label" for="result"><strong>Odpověď:</strong></label>
            <div class="col-sm-4">
              {% if result %}
                <input type="text" class="form-control" id="result" name="result" value="{{ result }}" oninput="countChars('result', 'displayto')">
              {% else %}
                <input type="text" class="form-control" id="result" name="result" placeholder="Zadejte odpověď" oninput="countChars('result', 'displayto')">
              {% endif %}
            </div>
            <div class="col-sm-1 col-form-label"><span id="displayto">{{ result_len }}</span></div>
          </div>
          <div class="row mt-2 mb-3">
            <div class="col-sm-4"></div>
            <div class="col-sm-4">
              <button type="submit" name="submit" class="me-2 btn btn-success">Odpovědět</button>
              <button type="submit" name="skip" class="mx-2 btn btn-warning">Přeskočit</button>
              <button type="submit" name="giveup" class="mx-2 btn btn-danger">Ukončit</button>
            </div>
          </div>
          {% if error_message %}
          <div class="row mb-3">
            <div class="col-sm-3"></div>
            <div class="alert alert-danger col-sm-6">
              <strong>Chyba!</strong> {{ error_message }}
            </div>
          </div>
          {% endif %}
        </form>
      </div>

    </div>

    <!-- Right column with player stats -->
    <div class="col-sm-auto">

      <!-- Player -->
      <div class="card">
        <img class="card-img-top" src="{{ player.difficulty.avatar_url }}" alt="{{ player.difficulty.avatar }}" style="height: 9.2vw; object-fit: cover;">
        <div class="card-body">
          <h5 class="card-title">Agent {{ player.name }}</h5>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><i>Krycí jméno: </i>{{ player.difficulty.avatar }}</li>
            <li class="list-group-item"><i>Obtížnost: </i>
              <span style="color: {% if player.difficulty.name == 'Těžká' %}red{% elif player.difficulty.name == 'Normální' %}orange{% else %}green{% endif %}">{{ player.difficulty.name }}</span>
            </li>
            <li class="list-group-item"><i>Score: </i>{{ player.score }}</li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>

{% endblock %}
